{"version":3,"sources":["format_card.js"],"names":["define","$","Ajax","init","touchHandler","event","touch","changedTouches","simulatedEvent","document","createEvent","initMouseEvent","touchstart","touchmove","touchend","type","window","screenX","screenY","clientX","clientY","target","dispatchEvent","preventDefault","ready","each","index","element","sectionwrapper","addEventListener","setEqualHeight","selector","length","selectorHeight","arr","css","elem","offsetHeight","push","Math","max","apply","getUrlParameter","sParam","sParameterName","i","sURLVariables","decodeURIComponent","location","search","substring","split","undefined","resize","on","id","this","closest","find","val","text","trim","html","M","util","get_string","removeClass","addClass","toggleClass","submit","e","opacity","visibility","animate","dragsort","dragSelector","dragBetween","dragEnd","section","data","courseid","sequence","map","get","toString","call","methodname","args","sectionid","done","placeHolderTemplate","course","format","get_config","container_node","container_class","section_node","section_class","swap_sections","Y","node1","node2","CSS","sectionlist","Node","all","get_section_selector","item","one","swap","process_sections","response","sectionfrom","sectionto","SELECTORS","action","temp","ele","str","stridx","newstr","content","create","sectiontitles","setHTML","getAttribute","lastIndexOf","substr","setAttribute","activity","activityid","toggle","oldsectionid","newsection","activitytomove","attr","newsectionid","activityidtomove","success","fadeOut","message","insertAfter","height","show"],"mappings":"AAuBAA,OAAO,CAAC,SAAU,YAAa,sCAAuC,SAASC,EAAGC,GAyQ9E,MAAO,CACHC,KAxQJ,WAOI,SAASC,EAAaC,GAClB,IAAIC,EAAQD,EAAME,eAAe,GAC7BC,EAAiBC,SAASC,YAAY,cACtCF,EAAeG,eAAe,CAC1BC,WAAY,YACZC,UAAW,YACXC,SAAU,WACZT,EAAMU,OAAO,GAAM,EAAMC,OAAQ,EACnCV,EAAMW,QAASX,EAAMY,QACrBZ,EAAMa,QAASb,EAAMc,SAAS,GAC9B,GAAO,GAAO,EAAO,EAAG,MAC5Bd,EAAMe,OAAOC,cAAcd,GAC3BH,EAAMkB,iBAhBVtB,EAAEQ,UAAUe,MAAM,WAoBdvB,EAAE,mBAAmBwB,KACjB,SAASC,EAAOC,GACZ,IAAIC,EAAiBD,EACrBC,EAAeC,iBAAiB,aAAczB,GAAc,GAC5DwB,EAAeC,iBAAiB,YAAazB,GAAc,GAC3DwB,EAAeC,iBAAiB,WAAYzB,GAAc,GAC1DwB,EAAeC,iBAAiB,cAAezB,GAAc,OAOzE,IAAI0B,EAAiB,SAASC,GAC1B,GAAIA,EAASC,OAAS,EAAG,CACrB,IACIC,EADAC,EAAM,GAEVH,EAASI,IAAI,aAAc,WAC3BJ,EAASN,KAAK,SAASC,EAAOU,GAE1BH,GADAA,EAAiBG,EAAKC,cAxCd,IAyC4CJ,EAzC5C,IA0CRC,EAAII,KAAKL,KAEbA,EAAiBM,KAAKC,IAAIC,MAAM,KAAMP,GAAO,GAC7CH,EAASI,IAAI,aAAcF,KAoCnC,SAASS,EAAgBC,GACrB,IAEAC,EACAC,EAFAC,EADeC,mBAAmB/B,OAAOgC,SAASC,OAAOC,UAAU,IAC1CC,MAAM,KAI/B,IAAKN,EAAI,EAAGA,EAAIC,EAAcd,OAAQa,IAGlC,IAFAD,EAAiBE,EAAcD,GAAGM,MAAM,MAErB,KAAOR,EACtB,YAA6BS,IAAtBR,EAAe,IAA0BA,EAAe,GA1C3E3C,EAAEe,QAAQqC,OAAO,WACbvB,EAAe7B,EAAE,2BAIrBA,EAAE,gCAAgCqD,GAAG,QAAS,WAC1C,IAAIC,EAAKtD,EAAEuD,MAAMC,QAAQ,QAAQC,KAAK,oBAAoBC,MACtDJ,IAEkB,aADDtD,EAAE,0BAA4BsD,GAAIK,OAAOC,QAEtD5D,EAAE,0BAA4BsD,GAAIO,KAAKC,EAAEC,KAAKC,WAAW,eAAgB,uBACzEhE,EAAE,mBAAqBsD,GAAIW,YAAY,eAEvCjE,EAAE,0BAA4BsD,GAAIO,KAAKC,EAAEC,KAAKC,WAAW,YAAa,uBACtEhE,EAAE,mBAAqBsD,GAAIY,SAAS,cAExClE,EAAEuD,MAAMC,QAAQ,6BAA6BW,YAAY,iBAIjEnE,EAAE,0BAA0BoE,OAAO,SAASC,GACxCA,EAAE/C,mBAINO,EAAe7B,EAAE,iBACjBA,EAAE,8DAA8DkE,SAAS,mBACzElE,EAAE,gBAAgBkC,IAAI,CAAEoC,QAAS,EAAKC,WAAY,YAAcC,QAAQ,CAAEF,QAAS,GAAQ,IAAK,SAyChGtE,EAAE,wBAAwByE,SAAS,CAC/BC,aAAc,kBACdC,aAAa,EACbC,QArBJ,WACI,IAAIC,EAAU7E,EAAEuD,MAAMuB,KAAK,WACvBC,EAAWtC,EAAgB,MAI3BuC,EAHOhF,EAAE,2BAA2BiF,IAAI,WACxC,OAAOjF,EAAEuD,MAAMuB,KAAK,QACrBI,MACiBC,WACFlF,EAAKmF,KAAK,CACxB,CACIC,WAAY,qCACZC,KAAM,CAACP,SAAUA,EAAUQ,UAAWV,EAASG,SAAUA,MAGrD,GAAGQ,KAAK,eASpBC,oBAAqB,iEAGzB3B,EAAE4B,OAAS5B,EAAE4B,QAAU,GAEvB5B,EAAE4B,OAAOC,OAAS7B,EAAE4B,OAAOC,QAAU,GAErC7B,EAAE4B,OAAOC,OAAOC,WAAa,WACzB,MAAO,CACHC,eAAgB,MAChBC,gBAAiB,QACjBC,aAAc,MACdC,cAAe,YAYvBlC,EAAE4B,OAAOC,OAAOM,cAAgB,SAASC,EAAGC,EAAOC,GAC/C,IAAIC,EACe,iBADfA,EAEiB,oBAGjBC,EAAcJ,EAAEK,KAAKC,IAAI,IAAMH,EAAoB,IAAMvC,EAAE4B,OAAOC,OAAOc,qBAAqBP,IAElGI,EAAYI,KAAKP,GAAOQ,IAAI,IAAMN,GAAqBO,KAAKN,EAAYI,KAAKN,GAAOO,IAAI,IAAMN,KAYlGvC,EAAE4B,OAAOC,OAAOkB,iBAAmB,SAASX,EAAGI,EAAaQ,EAAUC,EAAaC,GAC/E,IAAIX,EACa,cAEjBY,EACqB,8BAGrB,GAAuB,QAAnBH,EAASI,OAAkB,CAE3B,GAAIH,EAAcC,EAAW,CACzB,IAAIG,EAAOH,EACXA,EAAYD,EACZA,EAAcI,EAMlB,IAFA,IAAIC,EAAKC,EAAKC,EAAQC,EAEb3E,EAAImE,EAAanE,GAAKoE,EAAWpE,IAAK,CAE3C,IAAI4E,EAAUtB,EAAEK,KAAKkB,OAAO,SAAWX,EAASY,cAAc9E,GAAK,WACnE0D,EAAYI,KAAK9D,GAAG4D,IAAI,IAAMH,GAAiBsB,QAAQH,GAIvDF,GADAD,GADAD,EAAMd,EAAYI,KAAK9D,GAAG+D,IAAIM,IACpBW,aAAa,QACVC,YAAY,KACzBN,EAASF,EAAIS,OAAO,EAAGR,EAAS,GAAK1E,EACrCwE,EAAIW,aAAa,MAAOR,GACxBH,EAAIW,aAAa,QAASR,MAKtCvH,EAAE,sFAAsFqD,GAAG,QAAS,WAChG,IAAI0B,EAAWtC,EAAgB,MAC3BoC,EAAU7E,EAAEuD,MAAMuB,KAAK,gBACvBkD,EAAWhI,EAAEuD,MAAMuB,KAAK,iBACxBhD,EAAW9B,EAAEuD,MACEtD,EAAKmF,KAAK,CACzB,CACIC,WAAY,0CACZC,KAAM,CAACP,SAAUA,EAAUQ,UAAWV,EAASoD,WAAYD,MAGtD,GAAGxC,KAAK,SAASsB,GACL,OAAjBA,EAAShG,MACTd,EAAE8B,GAAU0B,QAAQ,0BAA0BS,YAAY,+BAA+BC,SAAS,UAClGlE,EAAE8B,GAAU0B,QAAQ,uCAAuCS,YAAY,WAAWC,SAAS,eAC3FlE,EAAE8B,GAAU2B,KAAK,oBAAoByE,WAErClI,EAAE8B,GAAU0B,QAAQ,0BAA0BS,YAAY,UAAUC,SAAS,+BAC7ElE,EAAE8B,GAAU0B,QAAQ,uCAAuCS,YAAY,uBACtEC,SAAS,WACVlE,EAAE8B,GAAU2B,KAAK,oBAAoByE,cAOjDlI,EAAE,qFAAqFqD,GAAG,QAAS,WAC/F,IAAI0B,EAAWtC,EAAgB,MAC3B0F,EAAenI,EAAEuD,MAAMuB,KAAK,gBAC5BsD,EAAapI,EAAEuD,MAAMuB,KAAK,mBAC1BuD,EAAiBrI,EAAEuD,MAAMC,QAAQ,0BAA0B8E,KAAK,WAChExG,EAAW9B,EAAEuD,MACWtD,EAAKmF,KAAK,CAClC,CACIC,WAAY,8CACZC,KAAM,CACFP,SAAUA,EACVwD,aAAcH,EACdD,aAAcA,EACdK,iBAAkBH,MAIR,GAAG7C,KAAK,SAASsB,GACX,GAApBA,EAAS2B,QACTzI,EAAE8B,GAAU0B,QAAQ,0BAA0BkF,QAAQ,QAEtD1I,EAAE,6DAA+D8G,EAAS6B,QAAU,UACnFC,YAAY5I,EAAE8B,GAAU0B,QAAQ,qDAMzBxD,EAAE,kCAAkC6I,SACpC,IAChB7I,EAAE,sBAAsB8I","sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Enhancements to Cards components for easy course accessibility.\r\n *\r\n * @module     format/remuiformat\r\n * @copyright  WisdmLabs\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\ndefine(['jquery', 'core/ajax', 'format_remuiformat/jquery.dragsort'], function($, Ajax) {\r\n\r\n    function init() {\r\n\r\n        var cardminHeight = 200;\r\n        $(document).ready(function() {\r\n            inittest();\r\n        });\r\n\r\n        function touchHandler(event) {\r\n            var touch = event.changedTouches[0];\r\n            var simulatedEvent = document.createEvent(\"MouseEvent\");\r\n                simulatedEvent.initMouseEvent({\r\n                    touchstart: \"mousedown\",\r\n                    touchmove: \"mousemove\",\r\n                    touchend: \"mouseup\"\r\n                }[event.type], true, true, window, 1,\r\n                touch.screenX, touch.screenY,\r\n                touch.clientX, touch.clientY, false,\r\n                false, false, false, 0, null);\r\n            touch.target.dispatchEvent(simulatedEvent);\r\n            event.preventDefault();\r\n        }\r\n\r\n        function inittest() {\r\n            $('a.wdm-drag-drop').each(\r\n                function(index, element) {\r\n                    var sectionwrapper = element;\r\n                    sectionwrapper.addEventListener(\"touchstart\", touchHandler, true);\r\n                    sectionwrapper.addEventListener(\"touchmove\", touchHandler, true);\r\n                    sectionwrapper.addEventListener(\"touchend\", touchHandler, true);\r\n                    sectionwrapper.addEventListener(\"touchcancel\", touchHandler, true);\r\n                }\r\n            );\r\n            // ...document.addEventListener(\"click\", touchHandler, true);.\r\n        }\r\n\r\n        // Function to set Equal Height of all cards.\r\n        var setEqualHeight = function(selector) {\r\n            if (selector.length > 0) {\r\n                var arr = [];\r\n                var selectorHeight;\r\n                selector.css(\"min-height\", \"initial\");\r\n                selector.each(function(index, elem) {\r\n                    selectorHeight = elem.offsetHeight;\r\n                    selectorHeight = (selectorHeight > cardminHeight) ? selectorHeight : cardminHeight;\r\n                    arr.push(selectorHeight);\r\n                });\r\n                selectorHeight = Math.max.apply(null, arr) + 55;\r\n                selector.css(\"min-height\", selectorHeight);\r\n            }\r\n        };\r\n\r\n        $(window).resize(function() {\r\n            setEqualHeight($('.single-card.wdm-col'));\r\n        });\r\n\r\n        // Mark Completion.\r\n        $('form.togglecompletion button').on('click', function() {\r\n            var id = $(this).closest(\"form\").find('input[name=\"id\"]').val();\r\n            if (id) {\r\n                var completion = $('.wdm-completion-status-' + id).text().trim();\r\n                if (completion == \"Completed\") {\r\n                    $('.wdm-completion-status-' + id).html(M.util.get_string('markcomplete', 'format_remuiformat'));\r\n                    $('.activity-check-' + id).removeClass(\"completed\");\r\n                } else {\r\n                    $('.wdm-completion-status-' + id).html(M.util.get_string('completed', 'format_remuiformat'));\r\n                    $('.activity-check-' + id).addClass(\"completed\");\r\n                }\r\n                $(this).closest(\".wdm-completion-container\").toggleClass(\"text-muted\");\r\n            }\r\n        });\r\n\r\n        $('.form.togglecompletion').submit(function(e) {\r\n            e.preventDefault();\r\n        });\r\n\r\n        // Set Equal height of cards on load.\r\n        setEqualHeight($('.single-card'));\r\n        $('#page-course-view-remuiformat span.section-modchooser-link').addClass(\"btn btn-primary\");\r\n        $('.single-card').css({ opacity: 0.0, visibility: \"visible\", }).animate({ opacity: 1.0, }, 600, \"swing\");\r\n\r\n        /**\r\n         * @param  {} sParam \r\n         */\r\n        function getUrlParameter(sParam) {\r\n            var sPageURL = decodeURIComponent(window.location.search.substring(1)),\r\n            sURLVariables = sPageURL.split('&'),\r\n            sParameterName,\r\n            i;\r\n\r\n            for (i = 0; i < sURLVariables.length; i++) {\r\n                sParameterName = sURLVariables[i].split('=');\r\n\r\n                if (sParameterName[0] === sParam) {\r\n                    return sParameterName[1] === undefined ? true : sParameterName[1];\r\n                }\r\n            }\r\n        }\r\n\r\n        /**\r\n         * It saves the activity order after drag and drop.\r\n         */\r\n        function saveOrder() {\r\n            var section = $(this).data('section');\r\n            var courseid = getUrlParameter('id');\r\n            var data = $(\".wdm-section-wrapper li\").map(function() {\r\n                return $(this).data(\"id\");\r\n            }).get();\r\n            var sequence = data.toString();\r\n            var sectionsave = Ajax.call([\r\n                {\r\n                    methodname: \"format_remuiformat_move_activities\",\r\n                    args: {courseid: courseid, sectionid: section, sequence: sequence}\r\n                }\r\n            ]);\r\n            sectionsave[0].done(function() {\r\n                // Ajax Done Code goes here.\r\n            });\r\n        }\r\n\r\n        $('.wdm-section-wrapper').dragsort({\r\n            dragSelector: \"a.wdm-drag-drop\",\r\n            dragBetween: true,\r\n            dragEnd: saveOrder,\r\n            placeHolderTemplate: \"<li class='placeHolder' style='border:1px solid gray;'></li>\"\r\n        });\r\n\r\n        M.course = M.course || {};\r\n\r\n        M.course.format = M.course.format || {};\r\n\r\n        M.course.format.get_config = function() {\r\n            return {\r\n                container_node: 'div',\r\n                container_class: 'cards',\r\n                section_node: 'div',\r\n                section_class: 'section'\r\n            };\r\n        };\r\n\r\n        /**\r\n         * Swap section\r\n         *\r\n         * @param {YUI} Y YUI3 instance\r\n         * @param {string} node1 node to swap to\r\n         * @param {string} node2 node to swap with\r\n         * @return {NodeList} section list\r\n         */\r\n        M.course.format.swap_sections = function(Y, node1, node2) {\r\n            var CSS = {\r\n                COURSECONTENT: 'course-content',\r\n                SECTIONADDMENUS: 'section_add_menus'\r\n            };\r\n\r\n            var sectionlist = Y.Node.all('.' + CSS.COURSECONTENT + ' ' + M.course.format.get_section_selector(Y));\r\n            // Swap menus.\r\n            sectionlist.item(node1).one('.' + CSS.SECTIONADDMENUS).swap(sectionlist.item(node2).one('.' + CSS.SECTIONADDMENUS));\r\n        };\r\n\r\n        /**\r\n         * Process sections after ajax response\r\n         *\r\n         * @param {YUI} Y YUI3 instance\r\n         * @param {array} response ajax response\r\n         * @param {string} sectionfrom first affected section\r\n         * @param {string} sectionto last affected section\r\n         * @return void\r\n         */\r\n        M.course.format.process_sections = function(Y, sectionlist, response, sectionfrom, sectionto) {\r\n            var CSS = {\r\n                SECTIONNAME: 'sectionname'\r\n            },\r\n            SELECTORS = {\r\n                SECTIONLEFTSIDE: '.left .section-handle .icon'\r\n            };\r\n\r\n            if (response.action == 'move') {\r\n                // If moving up swap around 'sectionfrom' and 'sectionto' so the that loop operates.\r\n                if (sectionfrom > sectionto) {\r\n                    var temp = sectionto;\r\n                    sectionto = sectionfrom;\r\n                    sectionfrom = temp;\r\n                }\r\n\r\n                // Update titles and move icons in all affected sections.\r\n                var ele, str, stridx, newstr;\r\n\r\n                for (var i = sectionfrom; i <= sectionto; i++) {\r\n                    // Update section title.\r\n                    var content = Y.Node.create('<span>' + response.sectiontitles[i] + '</span>');\r\n                    sectionlist.item(i).all('.' + CSS.SECTIONNAME).setHTML(content);\r\n                    // Update move icon.\r\n                    ele = sectionlist.item(i).one(SELECTORS.SECTIONLEFTSIDE);\r\n                    str = ele.getAttribute('alt');\r\n                    stridx = str.lastIndexOf(' ');\r\n                    newstr = str.substr(0, stridx + 1) + i;\r\n                    ele.setAttribute('alt', newstr);\r\n                    ele.setAttribute('title', newstr); // For FireFox as 'alt' is not refreshed.\r\n                }\r\n            }\r\n        };\r\n        // Call AJAX to set activity layout (Row or Card).\r\n        $('.wdm-section-wrapper .single-card-container .wdm-activity-actions .wdm-show-in-row').on('click', function() {\r\n            var courseid = getUrlParameter('id');\r\n            var section = $(this).data('wdmsectionid');\r\n            var activity = $(this).data('wdmactivityid');\r\n            var selector = $(this);\r\n            var activitysave = Ajax.call([\r\n                {\r\n                    methodname: \"format_remuiformat_show_activity_in_row\",\r\n                    args: {courseid: courseid, sectionid: section, activityid: activity}\r\n                }\r\n            ]);\r\n            activitysave[0].done(function(response) {\r\n                if (response.type == 'row') {\r\n                    $(selector).closest('.single-card-container').removeClass('col-lg-4 col-md-6 col-sm-12').addClass('col-12');\r\n                    $(selector).closest('.single-card-container .single-card').removeClass('wdm-col').addClass('wdm-min-row');\r\n                    $(selector).find('.wdmactivitytype').toggle();\r\n                } else {\r\n                    $(selector).closest('.single-card-container').removeClass('col-12').addClass('col-lg-4 col-md-6 col-sm-12');\r\n                    $(selector).closest('.single-card-container .single-card').removeClass('wdm-min-row wdm-row')\r\n                    .addClass('wdm-col');\r\n                    $(selector).find('.wdmactivitytype').toggle();\r\n                }\r\n                // SetEqualHeight($('.single-card'));.\r\n            });\r\n        });\r\n\r\n        // Call AJAX to move activity to specific section in cars format.\r\n        $('.wdm-section-wrapper .single-card-container .wdm-activity-actions .ecfsectionname').on('click', function() {\r\n            var courseid = getUrlParameter('id');\r\n            var oldsectionid = $(this).data('oldsectionid');\r\n            var newsection = $(this).data('sectionidtomove');\r\n            var activitytomove = $(this).closest('.single-card-container').attr('data-id');\r\n            var selector = $(this);\r\n            var activitymovetosection = Ajax.call([\r\n                {\r\n                    methodname: \"format_remuiformat_move_activity_to_section\",\r\n                    args: {\r\n                        courseid: courseid,\r\n                        newsectionid: newsection,\r\n                        oldsectionid: oldsectionid,\r\n                        activityidtomove: activitytomove\r\n                    }\r\n                }\r\n            ]);\r\n            activitymovetosection[0].done(function(response) {\r\n                if (response.success == 1) {\r\n                    $(selector).closest('.single-card-container').fadeOut('slow');\r\n                } else {\r\n                    $('<div class=\"wdmactivityerrormsg alert alert-danger mt-10\">' + response.message + '</div>')\r\n                    .insertAfter($(selector).closest('.single-card-container .wdm-activity-actions'));\r\n                }\r\n            });\r\n        });\r\n\r\n        // ... + Show full summary label show conditionally.\r\n        var summaryheight = $('.read-more-target .no-overflow').height();\r\n        if (summaryheight > 52) {\r\n            $('.read-more-trigger').show();\r\n        }\r\n    }\r\n    // Must return the init function.\r\n\r\n    return {\r\n        init: init\r\n    };\r\n});\r\n"],"file":"format_card.min.js"}