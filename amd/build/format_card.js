define(["jquery","core/ajax","format_remuiformat/jquery.dragsort"],function(t,e){return{init:function(){function o(t){var e=t.changedTouches[0],o=document.createEvent("MouseEvent");o.initMouseEvent({touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup"}[t.type],!0,!0,window,1,e.screenX,e.screenY,e.clientX,e.clientY,!1,!1,!1,!1,0,null),e.target.dispatchEvent(o),t.preventDefault()}t(document).ready(function(){t("a.wdm-drag-drop").each(function(t,e){var n=e;n.addEventListener("touchstart",o,!0),n.addEventListener("touchmove",o,!0),n.addEventListener("touchend",o,!0),n.addEventListener("touchcancel",o,!0)})});var n=function(t){if(t.length>0){var e,o=[];t.css("min-height","initial"),t.each(function(t,n){e=(e=n.offsetHeight)>200?e:200,o.push(e)}),e=Math.max.apply(null,o)+55,t.css("min-height",e)}};t(window).resize(function(){n(t(".single-card"))}),t(".mod-card-container").mouseover(function(){t(this).children(".mod-card-overlay").removeClass("hidden"),t(this).children(".card-hover-content").removeClass("hidden")}).mouseout(function(){t(this).children(".mod-card-overlay").addClass("hidden"),t(this).children(".card-hover-content").addClass("hidden")}),t(".card-complete-btn").click(function(){0==t(this).parent().children(".card-completion-state").val()?t(this).find(".card-stats").html(M.util.get_string("markcomplete","format_remuiformat")):t(this).find(".card-stats").html(M.util.get_string("completed","format_remuiformat"))}),t(".wdm-toggle-completion").click(function(){var e=t(this).data("id");return t(".wdm-completion-check-"+e+" button").trigger("click"),"Completed"==t(".wdm-completion-status-"+e).text().trim()?(t(".wdm-completion-status-"+e).html("Mark as Complete"),t(".activity-check-"+e).removeClass("completed"),t(".activity-check-"+e).addClass("text-muted")):(t(".wdm-completion-status-"+e).html("Completed"),t(".activity-check-"+e).removeClass("text-muted"),t(".activity-check-"+e).addClass("completed")),!1}),t(".form.togglecompletion").submit(function(t){t.preventDefault()}),n(t(".single-card")),t("#page-course-view-remuiformat span.section-modchooser-link").addClass("btn btn-primary"),t(".single-card").css({opacity:0,visibility:"visible"}).animate({opacity:1},600,"swing"),t(".wdm-section-wrapper").dragsort({dragSelector:"a.wdm-drag-drop",dragBetween:!0,dragEnd:function(){var o=t(this).data("section"),n=function(t){var e,o,n=decodeURIComponent(window.location.search.substring(1)).split("&");for(o=0;o<n.length;o++)if((e=n[o].split("="))[0]===t)return void 0===e[1]||e[1]}("id"),i=t(".wdm-section-wrapper li").map(function(){return t(this).data("id")}).get().toString();e.call([{methodname:"format_remuiformat_move_activities",args:{courseid:n,sectionid:o,sequence:i}}])[0].done(function(t){})},placeHolderTemplate:"<li class='placeHolder' style='border:1px solid gray;'></li>"}),M.course=M.course||{},M.course.format=M.course.format||{},M.course.format.get_config=function(){return{container_node:"ul",container_class:"cards",section_node:"li",section_class:"section"}},M.course.format.swap_sections=function(t,e,o){var n="course-content",i="section_add_menus",a=t.Node.all("."+n+" "+M.course.format.get_section_selector(t));a.item(e).one("."+i).swap(a.item(o).one("."+i))},M.course.format.process_sections=function(t,e,o,n,i){var a="sectionname",c=".left .section-handle .icon";if("move"==o.action){if(n>i){var r=i;i=n,n=r}for(var s,d,l,m,u=n;u<=i;u++){var h=t.Node.create("<span>"+o.sectiontitles[u]+"</span>");e.item(u).all("."+a).setHTML(h),l=(d=(s=e.item(u).one(c)).getAttribute("alt")).lastIndexOf(" "),m=d.substr(0,l+1)+u,s.setAttribute("alt",m),s.setAttribute("title",m)}}}}}});