define(["jquery","core/ajax","format_remuiformat/jquery.easypiechart","format_remuiformat/jquery.dragsort"],function(e,t){return{init:function(){function o(e){var t=e.changedTouches[0],o=document.createEvent("MouseEvent");o.initMouseEvent({touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup"}[e.type],!0,!0,window,1,t.screenX,t.screenY,t.clientX,t.clientY,!1,!1,!1,!1,0,null),t.target.dispatchEvent(o),e.preventDefault()}e(document).ready(function(){e("a.wdm-drag-drop").each(function(e,t){var a=t;a.addEventListener("touchstart",o,!0),a.addEventListener("touchmove",o,!0),a.addEventListener("touchend",o,!0),a.addEventListener("touchcancel",o,!0)})});var a=function(e){if(e.length>0){var t,o=[];e.css("min-height","initial"),e.each(function(e,a){t=(t=a.offsetHeight)>200?t:200,o.push(t)}),t=Math.max.apply(null,o)+55,e.css("min-height",t)}};e(window).resize(function(){a(e(".single-card"))}),e(".mod-card-container").mouseover(function(){e(this).children(".mod-card-overlay").removeClass("hidden"),e(this).children(".card-hover-content").removeClass("hidden")}).mouseout(function(){e(this).children(".mod-card-overlay").addClass("hidden"),e(this).children(".card-hover-content").addClass("hidden")}),e(".card-complete-btn").click(function(){0==e(this).parent().children(".card-completion-state").val()?e(this).find(".card-stats").html(M.util.get_string("markcomplete","format_remuiformat")):e(this).find(".card-stats").html(M.util.get_string("completed","format_remuiformat"))}),e(".wdm-toggle-completion").click(function(){var t=e(this).data("id");return e(".wdm-completion-check-"+t+" button").trigger("click"),"Completed"==e(".wdm-completion-status-"+t).text().trim()?(e(".wdm-completion-status-"+t).html("Mark as Complete"),e(".wdm-chart-"+t).data("easyPieChart").update(0),e(".activity-check-"+t).removeClass("completed"),e(".activity-check-"+t).addClass("text-muted")):(e(".wdm-completion-status-"+t).html("Completed"),e(".wdm-chart-"+t).data("easyPieChart").update(100),e(".activity-check-"+t).removeClass("text-muted"),e(".activity-check-"+t).addClass("completed")),!1}),e(".form.togglecompletion").submit(function(e){e.preventDefault()}),a(e(".single-card")),e("#page-course-view-remuiformat span.section-modchooser-link").addClass("btn btn-primary"),e("#page-course-view-remuiformat #changenumsections a").addClass("btn btn-primary"),e("#page-course-view-remuiformat #changenumsections").addClass("row d-flex justify-content-end"),e(".single-card").css({opacity:0,visibility:"visible"}).animate({opacity:1},600,"swing"),e(".pchart").easyPieChart({barColor:"#15C941",trackColor:!1,scaleColor:!1,lineWidth:3,size:40}),e(".wdm-section-wrapper").dragsort({dragSelector:"a.wdm-drag-drop",dragBetween:!0,dragEnd:function(){var o=e(this).data("section"),a=function(e){var t,o,a=decodeURIComponent(window.location.search.substring(1)).split("&");for(o=0;o<a.length;o++)if((t=a[o].split("="))[0]===e)return void 0===t[1]||t[1]}("id"),i=e(".wdm-section-wrapper li").map(function(){return e(this).data("id")}).get().toString();t.call([{methodname:"format_remuiformat_move_activities",args:{courseid:a,sectionid:o,sequence:i}}])[0].done(function(e){})},placeHolderTemplate:"<li class='placeHolder' style='border:1px solid gray;'></li>"}),M.course=M.course||{},M.course.format=M.course.format||{},M.course.format.get_config=function(){return{container_node:"ul",container_class:"cards",section_node:"li",section_class:"section"}},M.course.format.swap_sections=function(e,t,o){var a="course-content",i="section_add_menus",n=e.Node.all("."+a+" "+M.course.format.get_section_selector(e));n.item(t).one("."+i).swap(n.item(o).one("."+i))},M.course.format.process_sections=function(e,t,o,a,i){var n="sectionname",r=".left .section-handle .icon";if("move"==o.action){if(a>i){var c=i;i=a,a=c}for(var s,d,l,m,u=a;u<=i;u++){var h=e.Node.create("<span>"+o.sectiontitles[u]+"</span>");t.item(u).all("."+n).setHTML(h),l=(d=(s=t.item(u).one(r)).getAttribute("alt")).lastIndexOf(" "),m=d.substr(0,l+1)+u,s.setAttribute("alt",m),s.setAttribute("title",m)}}}}}});