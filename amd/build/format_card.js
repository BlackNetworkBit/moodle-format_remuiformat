define(["jquery","core/ajax","format_remuiformat/jquery.easypiechart","format_remuiformat/jquery.dragsort"],function(e,t){return{init:function(){function i(e){var t=e.changedTouches[0],i=document.createEvent("MouseEvent");i.initMouseEvent({touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup"}[e.type],!0,!0,window,1,t.screenX,t.screenY,t.clientX,t.clientY,!1,!1,!1,!1,0,null),t.target.dispatchEvent(i),e.preventDefault()}e(document).ready(function(){e("a.wdm-drag-drop").each(function(e,t){var o=t;o.addEventListener("touchstart",i,!0),o.addEventListener("touchmove",i,!0),o.addEventListener("touchend",i,!0),o.addEventListener("touchcancel",i,!0)})});var o=function(e){if(e.length>0){var t,i=[];e.css("min-height","initial"),e.each(function(e,o){t=(t=o.offsetHeight)>200?t:200,i.push(t)}),t=Math.max.apply(null,i)+55,e.css("min-height",t)}};e(window).resize(function(){o(e(".single-card"))}),e(".mod-card-container").mouseover(function(){e(this).children(".mod-card-overlay").removeClass("hidden"),e(this).children(".card-hover-content").removeClass("hidden")}).mouseout(function(){e(this).children(".mod-card-overlay").addClass("hidden"),e(this).children(".card-hover-content").addClass("hidden")}),e(".card-complete-btn").click(function(){0==e(this).parent().children(".card-completion-state").val()?e(this).find(".card-stats").html(M.util.get_string("markcomplete","format_remuiformat")):e(this).find(".card-stats").html(M.util.get_string("completed","format_remuiformat"))}),e(".wdm-toggle-completion").click(function(){var t=e(this).data("id");return e(".wdm-completion-check-"+t+" button").trigger("click"),"Completed"==e(".wdm-completion-status-"+t).text().trim()?(e(".wdm-completion-status-"+t).html("Mark as Complete"),e(".wdm-chart-"+t).data("easyPieChart").update(0),e(".activity-check-"+t).removeClass("completed"),e(".activity-check-"+t).addClass("text-muted")):(e(".wdm-completion-status-"+t).html("Completed"),e(".wdm-chart-"+t).data("easyPieChart").update(100),e(".activity-check-"+t).removeClass("text-muted"),e(".activity-check-"+t).addClass("completed")),!1}),e(".form.togglecompletion").submit(function(e){e.preventDefault()}),o(e(".single-card")),e(".section-action-container").addClass("card-bottom"),e(".wdm-bottom-container").addClass("card-bottom"),e("#page-course-view-remuiformat span.section-modchooser-link").addClass("btn btn-primary"),e("#page-course-view-remuiformat #changenumsections").css({visibility:"visible"}),e("#page-course-view-remuiformat #changenumsections a").addClass("btn btn-primary"),e("#page-course-view-remuiformat #changenumsections").addClass("row d-flex justify-content-end"),e(".general-single-card").css({opacity:0,visibility:"visible"}).animate({opacity:1},200,"swing"),e(".single-card").css({opacity:0,visibility:"visible"}).animate({opacity:1},400,"swing"),e(".pchart").easyPieChart({barColor:"#15C941",trackColor:!1,scaleColor:!1,lineWidth:3,size:40}),e(".wdm-section-wrapper").dragsort({dragSelector:"a.wdm-drag-drop",dragBetween:!0,dragEnd:function(){var i=e(this).data("section"),o=function(e){var t,i,o=decodeURIComponent(window.location.search.substring(1)).split("&");for(i=0;i<o.length;i++)if((t=o[i].split("="))[0]===e)return void 0===t[1]||t[1]}("id"),a=e(".wdm-section-wrapper li").map(function(){return e(this).data("id")}).get().toString();t.call([{methodname:"format_remuiformat_move_activities",args:{courseid:o,sectionid:i,sequence:a}}])[0].done(function(e){})},placeHolderTemplate:"<li class='placeHolder' style='border:1px solid gray;'></li>"}),M.course=M.course||{},M.course.format=M.course.format||{},M.course.format.get_config=function(){return{container_node:"ul",container_class:"cards",section_node:"li",section_class:"section"}},M.course.format.swap_sections=function(e,t,i){var o="course-content",a="section_add_menus",n=e.Node.all("."+o+" "+M.course.format.get_section_selector(e));n.item(t).one("."+a).swap(n.item(i).one("."+a))},M.course.format.process_sections=function(e,t,i,o,a){var n="sectionname",r=".left .section-handle .icon";if("move"==i.action){if(o>a){var c=a;a=o,o=c}for(var s,d,l,m,u=o;u<=a;u++){var h=e.Node.create("<span>"+i.sectiontitles[u]+"</span>");t.item(u).all("."+n).setHTML(h),l=(d=(s=t.item(u).one(r)).getAttribute("alt")).lastIndexOf(" "),m=d.substr(0,l+1)+u,s.setAttribute("alt",m),s.setAttribute("title",m)}}}}}});